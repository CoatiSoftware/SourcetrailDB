version: 0.0.0.{build}


image: 
    - Visual Studio 2017
    - Ubuntu
    - macos


environment:
    PYTHON_BINDINGS: 1
    JAVA_BINDINGS: 1
    PERL_BINDINGS: 1
    

platform: x64


configuration: Release


for:
-
    matrix:
        only:
            - image: Visual Studio 2017
    install:
    - cmd: |
        echo Building on Windows!
        echo Python: %PYTHON_BINDINGS%
        echo Java: %JAVA_BINDINGS%
        echo Perl: %PERL_BINDINGS%
    - ps: |
        echo "p1: $env:PLATFORM"
        echo "p2: $env:platform" 
        
        
    build_script:
    - cmd: echo Python - %PYTHON_BINDINGS%
-
    matrix:
        only:
            - image: Ubuntu
    install:
    - sh: |
        echo Building on Ubuntu!
        echo Python: $PYTHON_BINDINGS
        echo Java: $JAVA_BINDINGS
        echo Perl: $PERL_BINDINGS
    - exit 0
    - sh: |
        sudo add-apt-repository ppa:deadsnakes/ppa
        sudo apt-get update
        sudo apt-get install -qq swig
        if [[ "$PYTHON_BINDINGS" == "1" ]]; then
            sudo apt-get -y install python3.5
            sudo apt-get -y install python3.5-dev
            alias python="/usr/bin/python3.5"
            python --version
        fi
        if [[ "$JAVA_BINDINGS" == "1" ]]; then
            #installing Java not required, as image already comes with Java 9
            #sudo apt-get install openjdk-8-jdk
            javac -version
        fi
        if [[ "$PERL_BINDINGS" == "1" ]]; then
            #installing Perl not required, as image already comes with Perl 5
            #sudo apt-get install perl
            #alias perl="/usr/bin/perl"
            perl --version
        fi
    build_script:
    - sh: |
        mkdir build
        cd build  
        cmake -DBUILD_BINDINGS_PERL=$PERL_BINDINGS -DBUILD_BINDINGS_PYTHON=$PYTHON_BINDINGS -DPYTHON_VERSION=3.5 -DBUILD_BINDINGS_JAVA=$JAVA_BINDINGS ..
        make
    test_script:
    - sh: |
        ./core/test_core
-
    matrix:
        only:
            - image: macos
    install:
    - sh: |
        # Java bindings are currently disabled because JNI cannot be found by CMake
        JAVA_BINDINGS=0
    - sh: |
        echo Building on Mac OS!
        echo Python: $PYTHON_BINDINGS
        echo Java: $JAVA_BINDINGS
        echo Perl: $PERL_BINDINGS
    - exit 0
    - sh: |
        HOMEBREW_NO_AUTO_UPDATE=1 brew install swig
        brew link --force swig
        if [[ "$JAVA_BINDINGS" == "1" ]]; then
            HOMEBREW_NO_AUTO_UPDATE=1 brew install openjdk
        fi
        if [[ "$PERL_BINDINGS" == "1" ]]; then
            # installing Perl not required, as image already comes with Perl 5
            #HOMEBREW_NO_AUTO_UPDATE=1 brew install perl
            perl --version
        fi

    build_script:
    - sh: |
        mkdir build
        cd build  
        cmake -DBUILD_BINDINGS_PERL=$PERL_BINDINGS -DBUILD_BINDINGS_PYTHON=$PYTHON_BINDINGS  -DPYTHON_VERSION=3.6 -DBUILD_BINDINGS_JAVA=$JAVA_BINDINGS ..
        make
    test_script:
    - sh: |
        ./core/test_core


build_script:
    - echo ERROR - Empty default script was executed!
    - exit 1
